<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üç∞ Dolce Maria - Card√°pio Completo</title>
  <style>
    :root {
      --rosa: #ff69b4;
      --azul: #87cefa;
      --bg-claro: #fff0f5;
      --bg-escuro: #2d2d2d;
      --texto-claro: #333;
      --texto-escuro: #fff;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: var(--bg-claro);
      color: var(--texto-claro);
      transition: background-color 0.3s, color 0.3s;
    }

    body.dark {
      background: var(--bg-escuro);
      color: var(--texto-escuro);
    }

    h1 {
      text-align: center;
      color: var(--rosa);
      margin-bottom: 1rem;
    }

    .topo {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .topo input, .topo select, .topo button {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      min-width: 150px;
    }

    #bairro {
      min-width: 180px;
    }

    .toggle-tema {
      background: var(--rosa);
      color: white;
      cursor: pointer;
      border: none;
      min-width: 90px;
      transition: background-color 0.3s;
    }

    .toggle-tema:hover {
      background: #ff1493;
    }

    #produtos section {
      margin-bottom: 30px;
    }

    #produtos h2 {
      border-bottom: 2px solid var(--rosa);
      padding-bottom: 5px;
      margin-bottom: 10px;
      color: var(--rosa);
    }

    #produtos div.produto-card {
      border: 2px solid var(--rosa);
      padding: 10px;
      border-radius: 10px;
      background: white;
      display: inline-block;
      margin: 5px;
      width: 180px;
      vertical-align: top;
      box-shadow: 0 2px 8px rgba(255,105,180,0.3);
      transition: transform 0.3s ease;
    }

    #produtos div.produto-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(255,105,180,0.6);
    }

    #produtos div.produto-card strong {
      font-size: 1.1rem;
      display: block;
      margin-bottom: 5px;
      color: var(--rosa);
    }

    #produtos div.produto-card small {
      color: #666;
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
    }

    #produtos div.produto-card input[type=number] {
      width: 50px;
      padding: 5px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 8px;
    }

    #produtos div.produto-card button {
      background: var(--rosa);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      width: 100%;
      transition: background-color 0.3s;
    }

    #produtos div.produto-card button:hover {
      background: #ff1493;
    }

    #carrinho {
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 3px 15px rgba(255,105,180,0.4);
      max-width: 600px;
      margin: 0 auto 40px auto;
    }

    #carrinho h2 {
      color: var(--azul);
      margin-top: 0;
      margin-bottom: 15px;
      text-align: center;
    }

    #itens-carrinho {
      list-style: none;
      padding-left: 0;
      max-height: 250px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    #itens-carrinho li {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #eee;
      padding: 6px 0;
      font-weight: 600;
    }

    #itens-carrinho li button {
      background: transparent;
      border: none;
      color: #ff4d6d;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.1rem;
      transition: color 0.3s;
    }

    #itens-carrinho li button:hover {
      color: #ff1493;
    }

    #total {
      font-weight: bold;
      text-align: right;
      font-size: 1.2rem;
      margin-top: 10px;
      color: var(--azul);
    }

    #carrinho button#enviar-whatsapp {
      background: var(--azul);
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 15px;
    }

    #carrinho button#enviar-whatsapp:hover {
      background: #00aaff;
    }

    #feedback-msg {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--rosa);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(255,105,180,0.8);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 10000;
      pointer-events: none;
    }

    /* Bot√£o voltar ao topo */
    #btn-voltar-topo {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: var(--rosa);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px rgba(255,105,180,0.6);
      display: none;
      z-index: 9999;
      transition: background-color 0.3s;
    }

    #btn-voltar-topo:hover {
      background: #ff1493;
    }

    /* Dark mode ajustes */
    body.dark #produtos div.produto-card {
      background: #3b3b3b;
      border-color: #ff69b4;
      color: #eee;
      box-shadow: 0 2px 8px rgba(255,105,180,0.6);
    }
    body.dark #produtos div.produto-card small {
      color: #ccc;
    }
    body.dark #carrinho {
      background: #444;
      color: #eee;
      box-shadow: 0 3px 15px rgba(255,105,180,0.8);
    }
    body.dark #carrinho h2 {
      color: #87cefa;
    }
    body.dark #itens-carrinho li {
      border-color: #666;
    }
    body.dark #itens-carrinho li button {
      color: #ff99c8;
    }
    body.dark #itens-carrinho li button:hover {
      color: #ff66b2;
    }
    body.dark #total {
      color: #87cefa;
    }
    body.dark #carrinho button#enviar-whatsapp {
      background: #00aaff;
    }
    body.dark #carrinho button#enviar-whatsapp:hover {
      background: #0088cc;
    }
    body.dark #btn-voltar-topo {
      background: #ff69b4;
    }
    body.dark #btn-voltar-topo:hover {
      background: #ff1493;
    }
  </style>
</head>
<body>

  <h1>üç∞ Dolce Maria</h1>

  <div class="topo">
    <input type="text" id="busca" placeholder="üîç Buscar produto..." oninput="filtrarProdutos()" />
    <select id="tipo-pedido" aria-label="Tipo de pedido">
      <option value="local">Comer no Local</option>
      <option value="levar">Para Levar</option>
      <option value="entregar">Entregar</option>
    </select>
    <input type="text" id="bairro" placeholder="Bairro (para entrega)" aria-label="Bairro para entrega" />
    <input type="text" id="cupom" placeholder="Cupom de desconto" aria-label="Cupom de desconto" />
    <button class="toggle-tema" onclick="alternarTema()" aria-label="Alternar tema">üåì Tema</button>
  </div>

  <main id="produtos"></main>

  <section id="carrinho">
    <h2>üõí Seu Carrinho</h2>
    <ul id="itens-carrinho"></ul>
    <div id="total">Total: R$ 0,00</div>
    <button id="enviar-whatsapp" onclick="enviarPedidoWhatsApp()">Enviar via WhatsApp</button>
  </section>

  <button id="btn-voltar-topo" title="Voltar ao Topo" onclick="window.scrollTo({top:0, behavior:'smooth'})">üîù</button>

  <div id="feedback-msg" role="alert" aria-live="assertive"></div>

  <script>
    // Dados dos produtos por categoria e hor√°rio
    const produtos = {
      "Caf√© da Manh√£": [
        { nome: "Misto Quente", preco: 5 },
        { nome: "Caf√© com Leite", preco: 4 },
        { nome: "Tapioca", preco: 5 },
        { nome: "Cuscuz com Manteiga", preco: 6 }
      ],
      "Doces": [
        { nome: "Bolo de Pote", preco: 12 },
        { nome: "Brownie", preco: 5 },
        { nome: "Fatia de Bolo", preco: 3.5 }
      ],
      "Batatas Fritas": [
        { nome: "Batata Pequena", preco: 5 },
        { nome: "Batata M√©dia", preco: 8 },
        { nome: "Batata Grande", preco: 12 }
      ]
    };

    // Estado
    let carrinho = [];
    let descontoPercentual = 0;

    const taxaEntregaPorBairro = {
      "Centro": 5.00,
      "Zona Norte": 7.50,
      "Zona Sul": 6.00,
      "Zona Leste": 8.00,
      "Zona Oeste": 9.00
    };

    // Formatar pre√ßo para Real
    function formatarPreco(valor) {
      return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // Detecta o hor√°rio atual e retorna categoria com destaque
    function horarioAtual() {
      const h = new Date().getHours();
      if (h >= 5 && h < 11) return "Caf√© da Manh√£";
      if (h >= 11 && h < 15) return "Almo√ßo";
      if (h >= 15 && h < 18) return "Caf√© da Tarde";
      return "Jantar / Noite";
    }

    // Renderiza os produtos na tela, filtrando por busca
    function renderizarProdutos() {
      const container = document.getElementById('produtos');
      container.innerHTML = '';
      const destaque = horarioAtual();
      const termoBusca = document.getElementById('busca').value.trim().toLowerCase();

      for (const categoria in produtos) {
        // Filtra produtos pela busca
        const produtosFiltrados = produtos[categoria].filter(p =>
          p.nome.toLowerCase().includes(termoBusca)
        );

        if (produtosFiltrados.length === 0) continue;

        const secao = document.createElement('section');
        const titulo = document.createElement('h2');
        titulo.textContent = categoria + (categoria === destaque ? " üåü" : "");
        secao.appendChild(titulo);

        produtosFiltrados.forEach(produto => {
          const card = document.createElement('div');
          card.className = 'produto-card';
          card.innerHTML = `
            <strong>${produto.nome}</strong>
            <small>${formatarPreco(produto.preco)}</small>
            <input type="number" min="1" value="1" aria-label="Quantidade para ${produto.nome}" />
            <button onclick="adicionarAoCarrinho('${produto.nome}', ${produto.preco}, this)">Adicionar</button>
          `;
          secao.appendChild(card);
        });

        container.appendChild(secao);
      }

      if (container.innerHTML === '') {
        container.innerHTML = '<p style="text-align:center; color:#888;">Nenhum produto encontrado.</p>';
      }
    }

    // Adiciona produto ao carrinho
    function adicionarAoCarrinho(nome, preco, botao) {
      const inputQtd = botao.previousElementSibling;
      let qtd = parseInt(inputQtd.value);
      if (isNaN(qtd) || qtd < 1) qtd = 1;

      const indice = carrinho.findIndex(item => item.nome === nome);
      if (indice > -1) {
        carrinho[indice].quantidade += qtd;
      } else {
        carrinho.push({ nome, preco, quantidade: qtd });
      }
      atualizarCarrinho();
      mostrarFeedback(`+${qtd}x ${nome} adicionado!`);
    }

    // Atualiza carrinho na tela e c√°lculo de total, desconto e entrega
    function atualizarCarrinho() {
      const lista = document.getElementById('itens-carrinho');
      lista.innerHTML = '';

      const bairro = document.getElementById('bairro').value.trim();
      const tipoPedido = document.getElementById('tipo-pedido').value;

      let subtotal = 0;

      if (carrinho.length === 0) {
        lista.innerHTML = '<li>Seu carrinho est√° vazio.</li>';
      } else {
        carrinho.forEach((item, i) => {
          subtotal += item.preco * item.quantidade;
          const li = document.createElement('li');
          li.innerHTML = `
            ${item.quantidade}x ${item.nome} - ${formatarPreco(item.preco * item.quantidade)}
            <button onclick="removerItem(${i})" aria-label="Remover ${item.nome} do carrinho">‚úï</button>
          `;
          lista.appendChild(li);
        });
      }

      let taxaEntrega = 0;
      if (tipoPedido === 'entregar') {
        if (bairro && taxaEntregaPorBairro[bairro]) {
          taxaEntrega = taxaEntregaPorBairro[bairro];
        } else if (bairro) {
          taxaEntrega = 12;
        }
      }

      const descontoValor = subtotal * (descontoPercentual / 100);
      const total = subtotal - descontoValor + taxaEntrega;

      document.getElementById('total').textContent =
        `Subtotal: ${formatarPreco(subtotal)} | Desconto: -${formatarPreco(descontoValor)} | Entrega: ${formatarPreco(taxaEntrega)} | Total: ${formatarPreco(total)}`;
    }

    // Remove item do carrinho
    function removerItem(indice) {
      carrinho.splice(indice, 1);
      atualizarCarrinho();
    }

    // Aplica cupom de desconto ao mudar o campo
    document.getElementById('cupom').addEventListener('change', () => {
      const cupom = document.getElementById('cupom').value.trim().toUpperCase();
      switch(cupom) {
        case 'DOLCE10':
          descontoPercentual = 10;
          mostrarFeedback("Cupom DOLCE10 aplicado: 10% de desconto!");
          break;
        case 'BOLO5':
          descontoPercentual = 5;
          mostrarFeedback("Cupom BOLO5 aplicado: 5% de desconto!");
          break;
        default:
          descontoPercentual = 0;
          if (cupom !== '') mostrarFeedback("Cupom inv√°lido!");
      }
      atualizarCarrinho();
    });

    // Atualiza carrinho se mudar bairro ou tipo de pedido
    document.getElementById('bairro').addEventListener('input', atualizarCarrinho);
    document.getElementById('tipo-pedido').addEventListener('change', atualizarCarrinho);

    // Envia pedido via WhatsApp
    function enviarPedidoWhatsApp() {
      if (carrinho.length === 0) {
        alert("Seu carrinho est√° vazio!");
        return;
      }
      const tipoPedido = document.getElementById('tipo-pedido').value;
      const bairro = document.getElementById('bairro').value.trim() || "N√£o informado";

      let mensagem = `*Pedido Dolce Maria*\n\nTipo de pedido: ${tipoPedido}\nBairro: ${bairro}\n\nItens:\n`;
      carrinho.forEach(item => {
        mensagem += `- ${item.quantidade}x ${item.nome} (R$ ${item.preco.toFixed(2)})\n`;
      });

      let subtotal = carrinho.reduce((acc, i) => acc + i.preco * i.quantidade, 0);
      let descontoValor = subtotal * (descontoPercentual / 100);
      let taxaEntrega = 0;
      if (tipoPedido === 'entregar') {
        if (bairro && taxaEntregaPorBairro[bairro]) taxaEntrega = taxaEntregaPorBairro[bairro];
        else if (bairro !== "N√£o informado") taxaEntrega = 5;
      }
      let total = subtotal - descontoValor + taxaEntrega;

      mensagem += `\nSubtotal: R$ ${subtotal.toFixed(2)}`;
      mensagem += `\nDesconto: R$ ${descontoValor.toFixed(2)}`;
      mensagem += `\nTaxa de entrega: R$ ${taxaEntrega.toFixed(2)}`;
      mensagem += `\n*Total: R$ ${total.toFixed(2)}*\n\nObrigado pelo seu pedido! üíó`;

      const numeroWhats = '5521992083804'; // Coloque seu n√∫mero real aqui (DDD+telefone)

      const url = `https://wa.me/${numeroWhats}?text=${encodeURIComponent(mensagem)}`;

      window.open(url, '_blank');
    }

    // Feedback visual simples
    function mostrarFeedback(texto) {
      const feedback = document.getElementById('feedback-msg');
      feedback.textContent = texto;
      feedback.style.opacity = '1';
      setTimeout(() => {
        feedback.style.opacity = '0';
      }, 2500);
    }

    // Alterna tema claro/escuro
    function alternarTema() {
      document.body.classList.toggle('dark');
    }

    // Filtra produtos ao digitar na busca
    function filtrarProdutos() {
      renderizarProdutos();
    }

    // Mostrar bot√£o voltar topo ao rolar a p√°gina
    const btnTopo = document.getElementById('btn-voltar-topo');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 200) {
        btnTopo.style.display = 'block';
      } else {
        btnTopo.style.display = 'none';
      }
    });

    // Inicializa p√°gina
    window.onload = () => {
      renderizarProdutos();
      atualizarCarrinho();
    };
  </script>
</body>
</html>
