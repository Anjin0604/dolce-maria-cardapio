<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>StockPro ‚Äî Painel (virgem)</title>
<style>
  /* ===== Theme & Reset ===== */
  :root{
    --bg:#071427;
    --panel: rgba(255,255,255,0.03);
    --glass: rgba(255,255,255,0.04);
    --muted:#9fb1bf;
    --accent:#17a2a6;
    --success:#22c55e;
    --danger:#ff6b6b;
    --radius:12px;
    --shadow: 0 10px 30px rgba(2,6,23,0.6);
    --glass-strong: rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
  html,body,#app{height:100%}
  body{
    min-height:100vh;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(23,162,166,0.06), transparent 5%),
                linear-gradient(180deg, #071427 0%, #031021 100%);
    color:#e6f0f5;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:20px;
  }

  /* ===== Layout ===== */
  .app{display:grid;grid-template-columns:260px 1fr;gap:20px;align-items:start;max-width:1200px;margin:0 auto}
  @media(max-width:920px){.app{grid-template-columns:1fr;padding:12px} .sidebar{position:static;height:auto}}

  /* ===== Sidebar ===== */
  .sidebar{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);padding:18px;height:calc(100vh - 40px);position:sticky;top:20px;box-shadow:var(--shadow)
  }
  .brand{display:flex;gap:12px;align-items:center;margin-bottom:16px}
  .logo{width:50px;height:50px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#204a57);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px}
  .brand h1{font-size:16px}
  .brand p{color:var(--muted);font-size:12px;margin-top:2px}

  .nav{margin-top:12px;display:flex;flex-direction:column;gap:8px}
  .nav button{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer;font-size:14px}
  .nav button:hover{color:#fff;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}
  .nav button.active{color:#06121a;background:var(--accent);box-shadow:0 6px 20px rgba(23,162,166,0.12)}

  .nav .icon{width:20px;height:20px;display:inline-flex;align-items:center;justify-content:center;opacity:0.95}

  .sidebar .meta{margin-top:18px;color:var(--muted);font-size:13px}

  /* ===== Main ===== */
  .main{display:flex;flex-direction:column;gap:16px}
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .search{flex:1;display:flex;gap:8px;align-items:center}
  .search input{flex:1;padding:10px 12px;border-radius:10px;border:0;background:var(--glass);color:#e9fbff}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer}
  .btn.primary{background:var(--accent);color:#06121a;font-weight:700}
  .chip{background:var(--glass);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:13px}

  /* ===== Dashboard Cards ===== */
  .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
  @media(max-width:1100px){.cards{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:600px){.cards{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:var(--shadow)}
  .card h3{margin:0;font-size:13px;color:var(--muted)}
  .card .value{font-size:20px;font-weight:800;margin-top:6px;color:#fff}
  .placeholder{color:var(--muted);font-weight:600}

  /* ===== Content layout ===== */
  .content{display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media(max-width:1000px){.content{grid-template-columns:1fr}}

  /* left: lists & tables */
  .panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
  table{width:100%;border-collapse:collapse;color:#dbeefe}
  th,td{padding:10px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:14px}
  th{color:var(--muted);font-weight:600}
  .empty{padding:24px;text-align:center;color:var(--muted)}

  /* right: form */
  .side-form{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));padding:14px;border-radius:12px;box-shadow:var(--shadow)}
  .side-form h3{margin-bottom:8px;color:var(--muted)}
  label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
  input,select{width:100%;padding:10px;border-radius:8px;border:0;background:transparent;color:#e6f0f5}

  /* small helpers */
  .muted{color:var(--muted)}
  .tiny{font-size:12px;color:var(--muted)}
  .actions{display:flex;gap:8px}
  .footer{opacity:0.7;font-size:13px;color:var(--muted);margin-top:6px}

  /* subtle animation */
  .fade-up{animation:fadeUp .4s ease both}
  @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  /* tooltips minimal */
  .tooltip{position:relative}
  .tooltip[data-tip]:hover::after{
    content:attr(data-tip);
    position:absolute;background:#031021;padding:6px 8px;border-radius:6px;top:-36px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--muted);white-space:nowrap;box-shadow:var(--shadow)
  }
</style>
</head>
<body>
  <div id="app" class="app fade-up">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">SP</div>
        <div>
          <h1 style="font-size:15px">StockPro</h1>
          <p style="margin-top:4px;font-size:12px;color:var(--muted)">Gest√£o ¬∑ Estoque</p>
        </div>
      </div>

      <nav class="nav" role="navigation" aria-label="menu principal">
        <button class="active" data-view="dashboard"><span class="icon">üè†</span> Dashboard</button>
        <button data-view="estoque"><span class="icon">üì¶</span> Estoque</button>
        <button data-view="vendas"><span class="icon">üí≥</span> Vendas</button>
        <button data-view="relatorios"><span class="icon">üìà</span> Relat√≥rios</button>
        <button data-view="config"><span class="icon">‚öôÔ∏è</span> Configura√ß√µes</button>
      </nav>

      <div class="meta">
        <div style="margin-top:12px" class="tiny">Pronto para venda ‚Ä¢ Arquivo √∫nico HTML</div>
        <div style="margin-top:8px" class="tiny">Nenhum dado foi carregado ‚Äî ambiente limpo</div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="search">
          <input id="q" placeholder="Buscar (produto, categoria) ‚Äî vazio por padr√£o">
        </div>
        <div class="controls">
          <button class="btn" id="installBtn" style="display:none" title="Instalar">‚¨áÔ∏è Instalar</button>
          <div class="chip">Ol√°, Cliente</div>
        </div>
      </div>

      <!-- Cards -->
      <section class="cards" aria-label="M√©tricas principais">
        <div class="card">
          <h3>Total de produtos</h3>
          <div class="value" id="totalProducts"><span class="placeholder">‚Äî</span></div>
          <div class="tiny">Salvo localmente no navegador</div>
        </div>

        <div class="card">
          <h3>Vendas (R$)</h3>
          <div class="value" id="totalSales"><span class="placeholder">‚Äî</span></div>
          <div class="tiny">Nenhuma venda registrada</div>
        </div>

        <div class="card">
          <h3>Lucro estimado</h3>
          <div class="value" id="profit"><span class="placeholder">‚Äî</span></div>
          <div class="tiny">‚Äî</div>
        </div>

        <div class="card">
          <h3>Produtos com estoque baixo</h3>
          <div class="value" id="lowStock"><span class="placeholder">‚Äî</span></div>
          <div class="tiny">Configure o m√≠nimo em Configura√ß√µes</div>
        </div>
      </section>

      <!-- Main content area -->
      <div class="content">
        <!-- Left: Views -->
        <div>
          <div id="view-dashboard" class="panel view" aria-hidden="false">
            <h2 style="margin-bottom:10px">Vis√£o Geral</h2>
            <div class="empty">Painel limpo ‚Äî sem dados. Adicione produtos no formul√°rio √† direita.</div>
          </div>

          <div id="view-estoque" class="panel view" style="display:none" aria-hidden="true">
            <h2 style="margin-bottom:10px">Estoque</h2>
            <div id="table-estoque">
              <div class="empty">Nenhum produto cadastrado. Use o formul√°rio ao lado para adicionar.</div>
            </div>
          </div>

          <div id="view-vendas" class="panel view" style="display:none" aria-hidden="true">
            <h2 style="margin-bottom:10px">Vendas</h2>
            <div class="empty">Nenhuma venda registrada. Crie vendas a partir do produto no estoque depois de cadastrar.</div>
          </div>

          <div id="view-relatorios" class="panel view" style="display:none" aria-hidden="true">
            <h2 style="margin-bottom:10px">Relat√≥rios</h2>
            <div class="empty">Sem dados para gerar relat√≥rios.</div>
          </div>

          <div id="view-config" class="panel view" style="display:none" aria-hidden="true">
            <h2 style="margin-bottom:10px">Configura√ß√µes</h2>
            <label>Nome do neg√≥cio</label>
            <input id="bizName" placeholder="Ex: Padaria do Jo√£o">
            <label style="margin-top:8px">Estoque m√≠nimo padr√£o</label>
            <input id="minStock" type="number" value="2" min="0">
            <div style="margin-top:12px;display:flex;gap:8px">
              <button class="btn primary" id="saveConfig">Salvar</button>
              <button class="btn" id="resetAll">Limpar tudo</button>
            </div>
            <div class="footer">As configura√ß√µes ficam salvas localmente no navegador.</div>
          </div>
        </div>

        <!-- Right: Form -->
        <aside class="side-form">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <h3>Novo produto</h3>
            <div class="tiny muted">Salvar localmente</div>
          </div>

          <label>Nome</label>
          <input id="p-name" placeholder="Nome do produto">

          <label>Estoque inicial</label>
          <input id="p-stock" type="number" min="0" value="0">

          <label>Custo (R$)</label>
          <input id="p-cost" type="number" min="0" step="0.01" value="0">

          <label>Pre√ßo de venda (R$)</label>
          <input id="p-price" type="number" min="0" step="0.01" value="0">

          <label>Categoria</label>
          <input id="p-cat" placeholder="Ex: Bebidas">

          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn primary" id="addProduct">Adicionar</button>
            <button class="btn" id="clearForm">Limpar</button>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

          <div style="display:flex;flex-direction:column;gap:8px">
            <button class="btn" id="exportBtn">Exportar JSON</button>
            <input id="importFile" type="file" accept="application/json" style="display:none">
            <button class="btn" id="importBtn">Importar JSON</button>
            <button class="btn" id="sampleBtn" style="display:none">(opcional) Adicionar exemplos</button>
          </div>

          <div style="margin-top:10px;font-size:13px;color:var(--muted)">
            <div><strong>Observa√ß√£o:</strong> Este arquivo √© standalone ‚Äî todos os dados s√£o salvos no navegador do cliente.</div>
          </div>
        </aside>
      </div>

      <div class="footer tiny" style="margin-top:6px">StockPro ‚Ä¢ Prot√≥tipo virgem ‚Ä¢ Arquivo √∫nico</div>
    </main>
  </div>

<script>
/* ===== Simple app state (virgem por padr√£o) =====
   - All data stored in localStorage under key STOCKPRO_V1
   - On first load, state is empty (no products, no sales)
*/
const STORAGE_KEY = 'STOCKPRO_V1';

// default empty state
const defaultState = {
  products: [],   // { id, name, stock, cost, price, category }
  sales: [],      // { id, date, productId, qty, total, cost, price }
  config: { bizName: '', minStock: 2 }
};

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : JSON.parse(JSON.stringify(defaultState));
  }catch(e){
    console.error('load error', e);
    return JSON.parse(JSON.stringify(defaultState));
  }
}
function saveState(s){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
}

/* ===== UI helpers ===== */
function $(sel){return document.querySelector(sel)}
function $all(sel){return Array.from(document.querySelectorAll(sel))}

/* ===== Initial setup ===== */
let state = loadState(); // starts "virgem" if nothing saved

// Views nav
$all('.nav button').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    $all('.nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const view = btn.dataset.view;
    showView(view);
  });
});

function showView(name){
  const views = ['dashboard','estoque','vendas','relatorios','config'];
  views.forEach(v=>{
    const el = document.getElementById('view-'+v);
    if(!el) return;
    if(v === name){
      el.style.display = ''; el.setAttribute('aria-hidden','false');
    } else {
      el.style.display = 'none'; el.setAttribute('aria-hidden','true');
    }
  });
}

// Fill config inputs
$('#bizName').value = state.config.bizName || '';
$('#minStock').value = state.config.minStock ?? 2;

// placeholders on dashboard
function refreshDashboard(){
  const totalProducts = state.products.length;
  $('#totalProducts').innerHTML = totalProducts ? totalProducts : '<span class="placeholder">‚Äî</span>';

  // total sales and profit placeholders when empty
  if(state.sales.length === 0){
    $('#totalSales').innerHTML = '<span class="placeholder">‚Äî</span>';
    $('#profit').innerHTML = '<span class="placeholder">‚Äî</span>';
  } else {
    const totalSales = state.sales.reduce((s,x)=>s + (x.total || 0),0);
    const profit = state.sales.reduce((s,x)=>s + ((x.price - x.cost) * x.qty),0);
    $('#totalSales').textContent = totalSales.toFixed(2);
    $('#profit').textContent = 'R$ ' + profit.toFixed(2);
  }

  const lowCount = state.products.filter(p => p.stock <= (state.config.minStock ?? 2)).length;
  $('#lowStock').innerHTML = lowCount ? lowCount : '<span class="placeholder">‚Äî</span>';
}

// Render estoque table (virgin -> show empty)
function renderEstoque(){
  const container = $('#table-estoque');
  if(state.products.length === 0){
    container.innerHTML = '<div class="empty">Nenhum produto cadastrado. Use o formul√°rio ao lado para adicionar.</div>';
    return;
  }
  let html = '<table><thead><tr><th>Produto</th><th>Estoque</th><th>Custo</th><th>Venda</th><th>Categoria</th><th></th></tr></thead><tbody>';
  state.products.forEach(p=>{
    html += `<tr data-id="${p.id}"><td>${escapeHtml(p.name)}</td><td>${p.stock}</td><td>R$ ${Number(p.cost).toFixed(2)}</td><td>R$ ${Number(p.price).toFixed(2)}</td><td>${escapeHtml(p.category||'-')}</td><td><button class="btn" data-action="sell">Vender</button> <button class="btn" data-action="del">Excluir</button></td></tr>`;
  });
  html += '</tbody></table>';
  container.innerHTML = html;

  // attach row actions
  container.querySelectorAll('button[data-action]').forEach(b=>{
    b.addEventListener('click', (e)=>{
      const row = e.target.closest('tr');
      const id = row.dataset.id;
      const action = e.target.dataset.action;
      if(action === 'sell'){ openSellDialog(id) }
      if(action === 'del'){ if(confirm('Deseja excluir este produto?')){ deleteProduct(id); } }
    });
  });
}

function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

/* ===== Product actions ===== */
function addProductFromForm(){
  const name = $('#p-name').value.trim();
  const stock = Number($('#p-stock').value || 0);
  const cost = Number($('#p-cost').value || 0);
  const price = Number($('#p-price').value || 0);
  const category = $('#p-cat').value.trim();

  if(!name){
    alert('Preencha o nome do produto.');
    return;
  }

  const id = 'p_' + Date.now();
  const prod = { id, name, stock, cost, price, category };
  state.products.push(prod);
  saveState(state);
  renderEstoque(); refreshDashboard();
  clearForm();
  alert('Produto adicionado (arquivo limpo, salvo localmente).');
}

function clearForm(){
  $('#p-name').value = '';
  $('#p-stock').value = 0;
  $('#p-cost').value = 0;
  $('#p-price').value = 0;
  $('#p-cat').value = '';
}

function deleteProduct(id){
  state.products = state.products.filter(p=>p.id !== id);
  saveState(state); renderEstoque(); refreshDashboard();
}

/* ===== Sell flow (simple prompt modal) ===== */
function openSellDialog(productId){
  const product = state.products.find(p=>p.id===productId);
  if(!product) return alert('Produto n√£o encontrado.');
  const qty = Number(prompt(`Vender quantas unidades de "${product.name}"? (estoque atual: ${product.stock})`, '1'));
  if(!qty || qty <= 0) return;
  if(qty > product.stock) return alert('Estoque insuficiente.');
  // create sale
  const sale = { id:'s_'+Date.now(), date:Date.now(), productId, qty, total: Number((qty * product.price).toFixed(2)), cost: product.cost, price: product.price };
  state.sales.push(sale);
  product.stock -= qty;
  saveState(state); renderEstoque(); refreshDashboard();
  alert('Venda registrada e salva localmente.');
}

/* ===== Export / Import ===== */
$('#exportBtn').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'stockpro_backup.json'; a.click();
  URL.revokeObjectURL(url);
});

$('#importBtn').addEventListener('click', ()=>$('#importFile').click());
$('#importFile').addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try{
    const txt = await f.text(); const imported = JSON.parse(txt);
    if(!imported || typeof imported !== 'object') throw new Error('JSON inv√°lido');
    // simple validation
    imported.products = imported.products || [];
    imported.sales = imported.sales || [];
    imported.config = imported.config || defaultState.config;
    state = imported;
    saveState(state); renderEstoque(); refreshDashboard();
    alert('Importa√ß√£o conclu√≠da.');
  }catch(err){ alert('Erro ao importar: ' + err.message) }
});

/* ===== Config actions ===== */
$('#saveConfig').addEventListener('click', ()=>{
  state.config.bizName = $('#bizName').value.trim();
  state.config.minStock = Number($('#minStock').value || 2);
  saveState(state); refreshDashboard();
  alert('Configura√ß√µes salvas localmente.');
});

$('#resetAll').addEventListener('click', ()=>{
  if(!confirm('Limpar todos os dados salvos localmente?')) return;
  localStorage.removeItem(STORAGE_KEY);
  state = JSON.parse(JSON.stringify(defaultState));
  $('#bizName').value = state.config.bizName || '';
  $('#minStock').value = state.config.minStock || 2;
  renderEstoque(); refreshDashboard();
  alert('Dados removidos. Arquivo permanece virgem.');
});

/* ===== Form hooks ===== */
$('#addProduct').addEventListener('click', addProductFromForm);
$('#clearForm').addEventListener('click', clearForm);

/* ===== Search (local filter) ===== */
$('#q').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q){ renderEstoque(); return; }
  const container = $('#table-estoque');
  if(state.products.length === 0){ container.innerHTML = '<div class="empty">Nenhum produto cadastrado.</div>'; return; }
  const filtered = state.products.filter(p=> (p.name||'').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q));
  if(filtered.length === 0){ container.innerHTML = '<div class="empty">Nenhum produto encontrado.</div>'; return; }
  let html = '<table><thead><tr><th>Produto</th><th>Estoque</th><th>Custo</th><th>Venda</th><th>Categoria</th><th></th></tr></thead><tbody>';
  filtered.forEach(p=>{
    html += `<tr data-id="${p.id}"><td>${escapeHtml(p.name)}</td><td>${p.stock}</td><td>R$ ${Number(p.cost).toFixed(2)}</td><td>R$ ${Number(p.price).toFixed(2)}</td><td>${escapeHtml(p.category||'-')}</td><td><button class="btn" data-action="sell">Vender</button></td></tr>`;
  });
  html += '</tbody></table>';
  container.innerHTML = html;
  container.querySelectorAll('button[data-action="sell"]').forEach(b=>b.addEventListener('click', (e)=>{ const row=e.target.closest('tr'); openSellDialog(row.dataset.id); }));
});

/* ===== Row actions rebind after import/add/delete ===== */
function rebindRowActions(){
  document.querySelectorAll('#table-estoque button[data-action]').forEach(b=>{
    b.removeEventListener('click', ()=>{}); // no-op safe
  });
}

/* ===== Utilities ===== */
function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9) }

/* ===== Init render ===== */
renderEstoque(); refreshDashboard(); showView('dashboard');

/* ===== Accessibility small enhancements ===== */
document.addEventListener('keydown', (e)=>{
  // ctrl+f focuses search
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase() === 'f'){ e.preventDefault(); $('#q').focus(); }
});

/* ===== End ===== */
</script>
</body>
</html>
