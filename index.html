<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üç∞ Dolce Maria - Card√°pio Digital Completo</title>
<style>
  /* [Manter todos os estilos anteriores] */
  
  /* Adicionar novos estilos para op√ß√£o de retirada */
  .opcao-entrega {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  
  .opcao-entrega label {
    flex: 1;
    padding: 10px;
    border: 2px solid var(--azul-forte);
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .opcao-entrega input:checked + label {
    background: var(--azul-forte);
    color: white;
    border-color: var(--azul-forte);
  }
  
  body.escuro .opcao-entrega label {
    border-color: var(--rosa-forte);
  }
  
  body.escuro .opcao-entrega input:checked + label {
    background: var(--rosa-forte);
    border-color: var(--rosa-forte);
  }
  
  .grupo-bairro {
    transition: all 0.3s;
  }
  
  .grupo-bairro.oculto {
    opacity: 0.5;
    pointer-events: none;
  }
</style>
</head>
<body>

<!-- [Manter todo o HTML anterior at√© o carrinho flutuante] -->

<!-- Carrinho flutuante -->
<div id="carrinho-flutuante" class="compacto" title="Clique para abrir/fechar">
  <div class="icone-carrinho" aria-label="Carrinho de compras" role="button" tabindex="0">
    üõí
    <div class="contador-itens" aria-live="polite" aria-atomic="true">0</div>
  </div>
  <div class="conteudo-carrinho" style="display:none;">
    <h3>üõí Seu Carrinho</h3>
    <ul id="itens-carrinho"></ul>
    
    <div class="grupo-input">
      <label for="cupom-input">Cupom de desconto</label>
      <input type="text" id="cupom-input" placeholder="Ex: DOLCE10, BOLO3" />
      <small id="mensagem-cupom"></small>
    </div>
    
    <div class="grupo-input">
      <label>Op√ß√£o de consumo</label>
      <div class="opcao-entrega">
        <input type="radio" id="consumo-local" name="entrega" value="local" checked>
        <label for="consumo-local">Comer no Local</label>
        
        <input type="radio" id="entrega-domicilio" name="entrega" value="entrega">
        <label for="entrega-domicilio">Entrega</label>
      </div>
    </div>
    
    <div class="grupo-input grupo-bairro" id="grupo-bairro">
      <label for="bairro-input">Seu bairro</label>
      <select id="bairro-input">
        <option value="">Selecione seu bairro</option>
        <option value="Icurana">Icurana (R$ 3,00)</option>
        <option value="Vilar_carioca">Vilar Carioca (R$ 5,00)</option>
        <option value="Inhoaiba">Inhoa√≠ba (R$ 8,00)</option>
        <option value="Cosmos">Cosmos (R$ 10,00)</option>
      </select>
    </div>
    
    <div class="grupo-input">
      <label>Forma de pagamento</label>
      <div class="metodo-pagamento">
        <input type="radio" id="pagamento-dinheiro" name="pagamento" value="dinheiro" checked>
        <label for="pagamento-dinheiro">Dinheiro</label>
        
        <input type="radio" id="pagamento-pix" name="pagamento" value="pix">
        <label for="pagamento-pix">PIX</label>
      </div>
    </div>
    
    <div id="total-carrinho">Total: R$ 0,00</div>
    <button id="btn-enviar" disabled>üí¨ Enviar pedido via WhatsApp</button>
  </div>
</div>

<!-- [Manter o restante do HTML] -->

<script>
  // [Manter todas as vari√°veis e fun√ß√µes anteriores]

  // Atualizar carrinho
  function atualizarCarrinho() {
    const lista = document.getElementById("itens-carrinho");
    const totalEl = document.getElementById("total-carrinho");
    const contador = document.querySelector("#carrinho-flutuante .contador-itens");
    const opcaoEntrega = document.querySelector('input[name="entrega"]:checked').value;
    const bairroSelecionado = document.getElementById("bairro-input").value;
    
    // Mostrar/ocultar sele√ß√£o de bairro conforme op√ß√£o de entrega
    const grupoBairro = document.getElementById("grupo-bairro");
    if (opcaoEntrega === "local") {
      grupoBairro.classList.add("oculto");
    } else {
      grupoBairro.classList.remove("oculto");
    }
    
    // Calcular taxa de entrega (zero se for consumo no local)
    const taxaEntrega = opcaoEntrega === "entrega" && bairroSelecionado ? 
                        taxasEntrega[bairroSelecionado] || 0 : 0;

    lista.innerHTML = "";
    let subtotal = 0;

    // Adicionar itens ao carrinho
    carrinho.forEach((item, index) => {
      subtotal += item.preco;
      
      const li = document.createElement("li");
      li.innerHTML = `
        <span>${item.nome} - R$ ${item.preco.toFixed(2)}</span>
        <button class="remover-item" aria-label="Remover ${item.nome} do carrinho" title="Remover">‚úï</button>
      `;
      
      li.querySelector(".remover-item").addEventListener("click", () => removerDoCarrinho(index));
      lista.appendChild(li);
    });

    // Calcular desconto
    let desconto = 0;
    if (cupomAtivo) {
      desconto = subtotal * cupomAtivo.valor;
    }

    // Calcular total
    const total = subtotal - desconto + taxaEntrega;

    // Atualizar exibi√ß√£o
    if (cupomAtivo) {
      totalEl.innerHTML = `
        Subtotal: R$ ${subtotal.toFixed(2)}<br>
        Desconto (${cupomAtivo.codigo}): -R$ ${desconto.toFixed(2)}<br>
        ${opcaoEntrega === "entrega" && taxaEntrega > 0 ? 
          `Taxa de entrega: R$ ${taxaEntrega.toFixed(2)}<br>` : ''}
        <strong>Total: R$ ${total.toFixed(2)}</strong>
      `;
    } else {
      totalEl.innerHTML = `
        Subtotal: R$ ${subtotal.toFixed(2)}<br>
        ${opcaoEntrega === "entrega" && taxaEntrega > 0 ? 
          `Taxa de entrega: R$ ${taxaEntrega.toFixed(2)}<br>` : ''}
        <strong>Total: R$ ${total.toFixed(2)}</strong>
      `;
    }

    // Atualizar bot√£o de envio
    const precisaBairro = opcaoEntrega === "entrega" && !bairroSelecionado;
    document.getElementById("btn-enviar").disabled = carrinho.length === 0 || precisaBairro;

    // Atualizar contador no √≠cone do carrinho
    if (carrinho.length > 0) {
      contador.textContent = carrinho.length;
      contador.classList.add("exibir");
    } else {
      contador.textContent = "0";
      contador.classList.remove("exibir");
    }
  }

  // Enviar pedido por WhatsApp
  function enviarPedidoWhatsApp() {
    if (carrinho.length === 0) {
      mostrarFeedback("‚ùå Seu carrinho est√° vazio!");
      return;
    }
    
    const opcaoEntrega = document.querySelector('input[name="entrega"]:checked').value;
    const bairro = document.getElementById("bairro-input").value;
    
    if (opcaoEntrega === "entrega" && !bairro) {
      mostrarFeedback("‚ùå Selecione seu bairro para entrega!");
      return;
    }
    
    const metodoPagamento = document.querySelector('input[name="pagamento"]:checked').value;
    const taxaEntrega = opcaoEntrega === "entrega" ? taxasEntrega[bairro] || 0 : 0;
    
    let subtotal = 0;
    carrinho.forEach(item => subtotal += item.preco);
    
    let desconto = 0;
    if (cupomAtivo) {
      desconto = subtotal * cupomAtivo.valor;
    }
    
    const total = subtotal - desconto + taxaEntrega;
    
    // Criar mensagem
    let mensagem = "*üç∞ PEDIDO DOLCE MARIA üç∞*\n\n";
    mensagem += "*Tipo:* " + (opcaoEntrega === "local" ? "Consumo no Local" : "Entrega") + "\n";
    
    if (opcaoEntrega === "entrega") {
      mensagem += `*Bairro:* ${document.getElementById("bairro-input").options[document.getElementById("bairro-input").selectedIndex].text}\n`;
    }
    
    mensagem += "\n*Itens:*\n";
    
    // Agrupar itens por categoria
    const itensPorCategoria = {};
    carrinho.forEach(item => {
      if (!itensPorCategoria[item.categoria]) {
        itensPorCategoria[item.categoria] = [];
      }
      itensPorCategoria[item.categoria].push(item);
    });
    
    // Adicionar itens √† mensagem por categoria
    for (const categoria in itensPorCategoria) {
      mensagem += `\n*${categoria}:*\n`;
      itensPorCategoria[categoria].forEach(item => {
        mensagem += `- ${item.nome} - R$ ${item.preco.toFixed(2)}\n`;
      });
    }
    
    mensagem += "\n*Resumo do Pedido:*\n";
    mensagem += `Subtotal: R$ ${subtotal.toFixed(2)}\n`;
    
    if (cupomAtivo) {
      mensagem += `Desconto (${cupomAtivo.codigo}): -R$ ${desconto.toFixed(2)}\n`;
    }
    
    if (opcaoEntrega === "entrega") {
      mensagem += `Taxa de entrega: R$ ${taxaEntrega.toFixed(2)}\n`;
    }
    
    mensagem += `*Total: R$ ${total.toFixed(2)}*\n\n`;
    mensagem += `*Forma de pagamento:* ${metodoPagamento === 'dinheiro' ? 'Dinheiro' : 'PIX'}\n\n`;
    mensagem += "Aguardo confirma√ß√£o! üíñ";
    
    // N√∫mero do WhatsApp (substitua pelo seu n√∫mero real)
    const numero = "5521992083804";
    const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
    
    // Abrir WhatsApp
    window.open(url, "_blank");
    
    // Mostrar confirma√ß√£o
    mostrarModalConfirmacao();
    
    // Limpar carrinho ap√≥s envio
    carrinho = [];
    cupomAtivo = null;
    document.getElementById("cupom-input").value = "";
    document.getElementById("mensagem-cupom").textContent = "";
    document.getElementById("bairro-input").value = "";
    atualizarCarrinho();
    
    // Criar confetes
    criarConfetes(50);
  }

  // [Manter o restante do JavaScript]

  // Adicionar evento para op√ß√£o de entrega
  window.onload = () => {
    // [Manter todas as inicializa√ß√µes anteriores]
    
    // Adicionar listener para op√ß√£o de entrega
    document.querySelectorAll('input[name="entrega"]').forEach(radio => {
      radio.addEventListener('change', atualizarCarrinho);
    });
  };
</script>

</body>
</html>
